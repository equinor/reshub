#!/bin/csh
# -----------------------------------------------------------------------------
# cdproject_append
#
# Description:
#   This script appends one or more directories to a file named '.project_paths',
#   located in the user's home directory. The directories are stored as absolute paths,
#   ensuring they are fully resolved. Wildcards (*) are supported for adding multiple
#   directories at once.
#   
#   The script can be run by an alias in the ~/.cshrc file:
#
#   alias cda 'cdproject_append \!*' 
#   
# Usage:
#   cdproject_append [directories...]
#
# Arguments:
#   [directories...]  One or more directories to add to '.project_paths'.
#                     If no directories are specified, the current working
#                     directory is added.
#
# Features:
#   - Ensures all directories are stored as absolute paths.
#   - Expands wildcards to include multiple matching directories.
#   - Skips invalid paths (e.g., non-existent directories).
#   - Prevents duplicate entries in '.project_paths'.
#
# Example:
#   1. Add the current directory:
#        cdproject_append
#
#   2. Add a specific directory:
#        cdproject_append /path/to/project
#
#   3. Add multiple directories using wildcards:
#        cdproject_append ~/projects/* /tmp
#
# Notes:
#   - The script creates the '.project_paths' file in the home directory
#     if it does not already exist.
#   - Lines starting with '#' in '.project_paths' are considered comments
#     and ignored by related tools.
#
# Author:
#   ABEC, 01/2025
#
# -----------------------------------------------------------------------------

# Define the project paths file
set paths_file = ~/.project_paths

# Ensure the file exists
if (! -e $paths_file) then
    touch $paths_file
endif

# If no arguments are provided, use the current directory
if ($#argv == 0) then
    set dirs = (`pwd`)
else
    # Expand arguments to handle wildcards and resolve to full paths
    set dirs = ()
    foreach arg ($argv)
        foreach match (`eval echo $arg`)
            if (-d "$match") then
                set fullpath = `cd "$match" && pwd`
                set dirs = ($dirs $fullpath)
            else
                echo "Warning: $match is not a valid directory. Skipping."
            endif
        end
    end
endif

echo $dirs

# Loop through directories and add them to the file if they aren't duplicates
foreach dir ($dirs)
    # Ensure the directory exists
    if (! -d "$dir") then
        echo "Warning: $dir is not a valid directory. Skipping."
        continue
    endif
    # Check if the directory already exists in the file
    grep -q "^$dir" $paths_file
    if ($status == 0) then
        echo "Directory already exists in .project_paths: $dir"
        continue
    endif

    # Append the directory to the file
    echo "$dir" >> $paths_file
    echo "Added: $dir"
end

exit 0

